<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KINGU ELECTRICAL COMPANY LIMITED - Invoice System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- jsPDF Library for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --kingu-green: #116a41;
            --kingu-red: #e63946;
            --kingu-yellow-start: #ffae42;
            --kingu-yellow-end: #ffea00;
            --kingu-dark: #0a4d2a;
            --kingu-light: #e8f5e9;
            --kingu-accent: #ff6b35;
            --kingu-success: #2a9d8f;
            --kingu-white: #ffffff;
            --kingu-blue: #2980b9;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background: linear-gradient(135deg, var(--kingu-green) 0%, var(--kingu-dark) 100%);
            color: white;
            padding: 25px 20px;
            box-shadow: 2px 0 15px rgba(17, 106, 65, 0.3);
        }

        .logo-container {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--kingu-yellow-start) 0%, var(--kingu-yellow-end) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .logo:before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            background: white;
            border-radius: 50%;
            z-index: 1;
        }

        .logo i {
            font-size: 28px;
            color: var(--kingu-red);
            z-index: 2;
            position: relative;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .company-header {
            line-height: 1.2;
            margin-bottom: 3px;
        }

        .company-header .kingu {
            font-size: 20px;
            font-weight: 800;
            color: white;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: block;
        }

        .company-header .electrical {
            font-size: 16px;
            font-weight: 700;
            color: var(--kingu-red);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            display: block;
            margin-top: -2px;
        }

        .company-full-name {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 2px;
            font-weight: 500;
            line-height: 1;
        }

        .company-tagline {
            font-size: 11px;
            opacity: 0.9;
            margin-top: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-style: italic;
            line-height: 1.3;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 5px;
        }

        .nav-menu {
            list-style: none;
            margin-top: 30px;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            padding: 12px 15px;
            border-radius: 8px;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-link i {
            margin-right: 12px;
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.15);
            border-left: 3px solid var(--kingu-red);
        }

        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-left: 3px solid var(--kingu-red);
            font-weight: 600;
        }

        /* Company Info in Sidebar */
        .company-info-sidebar {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 13px;
        }

        .company-info-sidebar p {
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
            line-height: 1.4;
        }

        .company-info-sidebar i {
            margin-right: 10px;
            margin-top: 3px;
            color: var(--kingu-yellow-end);
            min-width: 16px;
        }

        .contact-badge {
            display: inline-block;
            background-color: var(--kingu-red);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
            font-weight: bold;
        }

        /* Contact Badges */
        .contact-badges {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .contact-badge-small {
            display: inline-flex;
            align-items: center;
            background-color: var(--kingu-light);
            color: var(--kingu-green);
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: 600;
            border: 1px solid rgba(17, 106, 65, 0.2);
        }

        .contact-badge-small i {
            margin-right: 5px;
            font-size: 14px;
        }

        .whatsapp-badge {
            background-color: rgba(37, 211, 102, 0.1);
            color: #128C7E;
            border-color: rgba(37, 211, 102, 0.3);
        }

        .email-badge {
            background-color: rgba(66, 133, 244, 0.1);
            color: #4285f4;
            border-color: rgba(66, 133, 244, 0.3);
        }

        .color-scheme {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .green { background-color: var(--kingu-green); }
        .red { background-color: var(--kingu-red); }
        .yellow-start { background-color: var(--kingu-yellow-start); }
        .yellow-end { background-color: var(--kingu-yellow-end); }
        .blue { background-color: var(--kingu-blue); }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background-color: var(--kingu-white);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--kingu-light);
        }

        .header h1 {
            color: var(--kingu-green);
            font-size: 28px;
            position: relative;
            padding-left: 15px;
        }

        .header h1:before {
            content: '';
            position: absolute;
            left: 0;
            top: 5px;
            bottom: 5px;
            width: 4px;
            background: linear-gradient(to bottom, var(--kingu-green), var(--kingu-red));
            border-radius: 2px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background-color: var(--kingu-green);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--kingu-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(17, 106, 65, 0.2);
        }

        .btn-success {
            background-color: var(--kingu-success);
            color: white;
        }

        .btn-success:hover {
            background-color: #21867a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(42, 157, 143, 0.2);
        }

        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
            transform: translateY(-2px);
        }

        .btn-accent {
            background-color: var(--kingu-red);
            color: white;
        }

        .btn-accent:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(230, 57, 70, 0.2);
        }

        .btn-whatsapp {
            background-color: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background-color: #128C7E;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.2);
        }

        .btn-pdf {
            background-color: #d32f2f;
            color: white;
        }

        .btn-pdf:hover {
            background-color: #b71c1c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(211, 47, 47, 0.2);
        }

        .btn i {
            margin-right: 8px;
        }

        /* Invoice Type Selector */
        .invoice-type-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(17, 106, 65, 0.1);
            border-left: 4px solid var(--kingu-green);
        }

        .type-btn {
            padding: 10px 25px;
            border: 2px solid var(--kingu-green);
            background: white;
            color: var(--kingu-green);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .type-btn.active {
            background: var(--kingu-green);
            color: white;
        }

        .type-btn.quotation-active {
            background: var(--kingu-blue);
            color: white;
            border-color: var(--kingu-blue);
        }

        .type-btn:hover:not(.active):not(.quotation-active) {
            background-color: var(--kingu-light);
        }

        /* Invoice Form Container */
        .invoice-form-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(17, 106, 65, 0.1);
            padding: 30px;
            margin-bottom: 30px;
            border-top: 4px solid var(--kingu-green);
            max-width: 100%;
            overflow-x: hidden;
        }

        .quotation-form-container {
            border-top: 4px solid var(--kingu-blue);
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            color: var(--kingu-green);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--kingu-light);
            display: flex;
            align-items: center;
        }

        .quotation-section-title {
            color: var(--kingu-blue);
        }

        .section-title i {
            margin-right: 10px;
            color: var(--kingu-red);
        }

        .quotation-section-title i {
            color: var(--kingu-blue);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -15px;
        }

        .form-group {
            flex: 1;
            min-width: 250px;
            padding: 0 15px;
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--kingu-dark);
            font-size: 14px;
        }

        .quotation-form-group label {
            color: var(--kingu-blue);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--kingu-green);
            box-shadow: 0 0 0 3px rgba(17, 106, 65, 0.1);
        }

        .quotation-control:focus {
            border-color: var(--kingu-blue);
            box-shadow: 0 0 0 3px rgba(41, 128, 185, 0.1);
        }

        /* Proforma Specific Fields */
        .proforma-fields {
            background-color: var(--kingu-light);
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid var(--kingu-red);
        }

        .quotation-fields {
            background-color: rgba(41, 128, 185, 0.1);
            border-left: 4px solid var(--kingu-blue);
        }

        /* Invoice Items Table */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .items-table thead {
            background-color: var(--kingu-green);
        }

        .quotation-items-table thead {
            background-color: var(--kingu-blue);
        }

        .items-table th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: white;
            border-bottom: 2px solid var(--kingu-dark);
        }

        .quotation-items-table th {
            border-bottom: 2px solid #1a5276;
        }

        .items-table td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .items-table tr:hover {
            background-color: #f9fafb;
        }

        .items-table input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .delete-item {
            background-color: var(--kingu-red);
            color: white;
            border: none;
            border-radius: 4px;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .delete-item:hover {
            background-color: #c62828;
            transform: scale(1.05);
        }

        .add-item-btn {
            margin-top: 15px;
            background-color: var(--kingu-light);
            color: var(--kingu-green);
            border: 2px dashed var(--kingu-green);
            border-radius: 8px;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }

        .quotation-add-item-btn {
            background-color: rgba(41, 128, 185, 0.1);
            color: var(--kingu-blue);
            border: 2px dashed var(--kingu-blue);
        }

        .add-item-btn:hover {
            background-color: var(--kingu-green);
            color: white;
            border-color: var(--kingu-green);
        }

        .quotation-add-item-btn:hover {
            background-color: var(--kingu-blue);
            color: white;
            border-color: var(--kingu-blue);
        }

        .add-item-btn i {
            margin-right: 8px;
        }

        /* Totals Section */
        .totals-section {
            background: linear-gradient(135deg, #f8fafc 0%, var(--kingu-light) 100%);
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid var(--kingu-green);
        }

        .quotation-totals-section {
            background: linear-gradient(135deg, #f8fafc 0%, rgba(41, 128, 185, 0.1) 100%);
            border-left: 4px solid var(--kingu-blue);
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(17, 106, 65, 0.1);
        }

        .quotation-total-row {
            border-bottom: 1px solid rgba(41, 128, 185, 0.2);
        }

        .total-label {
            font-weight: 600;
            color: var(--kingu-dark);
        }

        .quotation-total-label {
            color: var(--kingu-blue);
        }

        .total-value {
            font-weight: 700;
            color: var(--kingu-green);
        }

        .quotation-total-value {
            color: var(--kingu-blue);
        }

        .grand-total {
            font-size: 20px;
            border-top: 2px solid var(--kingu-green);
            margin-top: 10px;
            padding-top: 15px;
            color: var(--kingu-dark);
        }

        .quotation-grand-total {
            border-top: 2px solid var(--kingu-blue);
            color: var(--kingu-blue);
        }

        /* Invoice Preview - Optimized for A4 */
        .invoice-preview-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(17, 106, 65, 0.1);
            padding: 30px;
            margin-top: 30px;
            display: none;
            border-top: 4px solid var(--kingu-green);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            font-size: 12px;
        }

        .quotation-preview-container {
            border-top: 4px solid var(--kingu-blue);
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--kingu-light);
            flex-wrap: wrap;
        }

        .invoice-company-logo {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            max-width: 250px;
            flex: 1;
            min-width: 200px;
        }

        .company-logo-text {
            font-family: 'Georgia', serif;
        }

        .kingu-logo {
            font-size: 36px;
            font-weight: 900;
            color: var(--kingu-green);
            line-height: 0.9;
            margin-bottom: 3px;
            display: block;
        }

        .electrical-logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--kingu-red);
            line-height: 0.9;
            margin-bottom: 5px;
            display: block;
            margin-left: 0;
        }

        .company-logo {
            font-size: 16px;
            font-weight: 700;
            color: var(--kingu-dark);
            margin-bottom: 8px;
            border-top: 2px solid var(--kingu-light);
            padding-top: 8px;
            margin-top: 3px;
        }

        .tagline-logo {
            font-size: 11px;
            color: #666;
            font-style: italic;
            line-height: 1.3;
            margin-bottom: 10px;
        }

        .contact-info-logo {
            font-size: 11px;
            color: #555;
            line-height: 1.4;
        }

        .contact-info-logo .phone-numbers {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin: 3px 0;
        }

        .contact-info-logo .phone-numbers span {
            background-color: var(--kingu-light);
            padding: 2px 6px;
            border-radius: 3px;
            border: 1px solid rgba(17, 106, 65, 0.2);
            display: inline-block;
            width: fit-content;
            font-size: 10px;
        }

        .contact-info-logo .email {
            color: var(--kingu-green);
            font-weight: 600;
            margin: 3px 0;
            font-size: 11px;
        }

        .contact-info-logo .address {
            font-size: 10px;
            color: #777;
            margin-top: 3px;
        }

        .company-tin {
            font-size: 10px;
            color: #555;
            font-weight: 600;
            margin-top: 5px;
            padding: 2px 6px;
            background-color: var(--kingu-light);
            border-radius: 3px;
            display: inline-block;
            border: 1px solid rgba(17, 106, 65, 0.2);
        }

        .invoice-title {
            font-size: 24px;
            color: var(--kingu-green);
            text-align: right;
            font-weight: 700;
            flex: 1;
            min-width: 200px;
            margin-top: 10px;
        }

        .quotation-title {
            color: var(--kingu-blue);
        }

        .invoice-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .company-info, .client-info {
            flex: 1;
            min-width: 200px;
        }

        .info-title {
            font-weight: 700;
            color: var(--kingu-green);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--kingu-light);
            font-size: 14px;
        }

        .quotation-info-title {
            color: var(--kingu-blue);
        }

        .company-details p, .client-details p {
            margin-bottom: 6px;
            color: #555;
            font-size: 12px;
        }

        .invoice-info {
            flex: 0.8;
            min-width: 200px;
        }

        .invoice-info-box {
            background-color: var(--kingu-light);
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid var(--kingu-green);
            font-size: 12px;
        }

        .quotation-info-box {
            background-color: rgba(41, 128, 185, 0.1);
            border-left: 3px solid var(--kingu-blue);
        }

        .invoice-info-box p {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }

        .invoice-info-box strong {
            color: var(--kingu-dark);
        }

        .quotation-info-box strong {
            color: var(--kingu-blue);
        }

        .invoice-items-preview {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
            font-size: 11px;
        }

        .invoice-items-preview thead {
            background-color: var(--kingu-green);
        }

        .quotation-items-preview thead {
            background-color: var(--kingu-blue);
        }

        .invoice-items-preview th {
            padding: 12px 8px;
            text-align: left;
            font-weight: 700;
            color: white;
            border-bottom: 2px solid var(--kingu-dark);
            font-size: 12px;
        }

        .quotation-items-preview th {
            border-bottom: 2px solid #1a5276;
        }

        .invoice-items-preview td {
            padding: 10px 8px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 11px;
        }

        .invoice-items-preview tbody tr:nth-child(even) {
            background-color: #f9fafb;
        }

        .invoice-totals {
            width: 300px;
            margin-left: auto;
            margin-top: 20px;
            background: var(--kingu-light);
            padding: 20px;
            border-radius: 6px;
            border-left: 3px solid var(--kingu-green);
            font-size: 12px;
        }

        .quotation-totals {
            background: rgba(41, 128, 185, 0.1);
            border-left: 3px solid var(--kingu-blue);
        }

        .terms-section {
            background-color: #f8fafc;
            padding: 20px;
            border-radius: 6px;
            margin-top: 30px;
            border-left: 3px solid var(--kingu-red);
            font-size: 11px;
        }

        .quotation-terms-section {
            border-left: 3px solid var(--kingu-blue);
        }

        .terms-title {
            color: var(--kingu-green);
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            font-size: 14px;
        }

        .quotation-terms-title {
            color: var(--kingu-blue);
        }

        .terms-title i {
            margin-right: 8px;
            color: var(--kingu-red);
            font-size: 14px;
        }

        .quotation-terms-title i {
            color: var(--kingu-blue);
        }

        .terms-content p {
            margin-bottom: 8px;
            color: #555;
            font-size: 11px;
            line-height: 1.4;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }

        /* Footer Styles */
        .invoice-footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid var(--kingu-light);
            text-align: center;
            font-size: 11px;
        }

        .authorized-signature {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .signature-line {
            width: 250px;
            height: 1px;
            background-color: #333;
            margin: 30px auto 8px;
        }

        .signature-text {
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        /* Utility Classes */
        .hidden {
            display: none;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .currency-select {
            width: 120px;
            margin-right: 10px;
            border: 1px solid var(--kingu-green);
        }

        .quotation-currency-select {
            border: 1px solid var(--kingu-blue);
        }

        .stamp {
            position: absolute;
            right: 20px;
            bottom: 20px;
            padding: 10px 20px;
            background-color: var(--kingu-light);
            border: 2px dashed var(--kingu-green);
            border-radius: 6px;
            text-align: center;
            font-weight: 700;
            color: var(--kingu-green);
            transform: rotate(5deg);
            font-size: 12px;
            max-width: 150px;
        }

        .quotation-stamp {
            position: absolute;
            right: 20px;
            top: 20px;
            padding: 10px 20px;
            background-color: rgba(41, 128, 185, 0.1);
            border: 2px dashed var(--kingu-blue);
            border-radius: 6px;
            text-align: center;
            font-weight: 700;
            color: var(--kingu-blue);
            transform: rotate(5deg);
            font-size: 12px;
            max-width: 150px;
        }

        /* Invoice History & Proforma Invoices Styles */
        .history-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(17, 106, 65, 0.1);
            padding: 30px;
            margin-top: 20px;
            border-top: 4px solid var(--kingu-green);
            display: none;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .history-table th {
            background-color: var(--kingu-green);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .history-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .history-table tr:hover {
            background-color: #f9fafb;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-paid {
            background-color: rgba(46, 204, 113, 0.2);
            color: #27ae60;
        }

        .status-pending {
            background-color: rgba(241, 196, 15, 0.2);
            color: #f39c12;
        }

        .status-overdue {
            background-color: rgba(231, 76, 60, 0.2);
            color: #c0392b;
        }

        .status-quotation {
            background-color: rgba(41, 128, 185, 0.2);
            color: var(--kingu-blue);
        }

        .action-btn-small {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-right: 5px;
        }

        .action-btn-small:hover {
            transform: translateY(-1px);
        }

        /* A4 Print Styles */
        @media print {
            @page {
                size: A4;
                margin: 15mm;
            }
            
            body, html {
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                width: 210mm !important;
                height: 297mm !important;
            }
            
            body * {
                visibility: hidden;
            }
            
            .invoice-preview-container,
            .invoice-preview-container *,
            .a4-document,
            .a4-document * {
                visibility: visible !important;
            }
            
            .invoice-preview-container,
            .a4-document {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 210mm !important;
                min-height: 297mm !important;
                margin: 0 !important;
                padding: 15mm !important;
                box-shadow: none !important;
                background-color: white !important;
                border: none !important;
                border-radius: 0 !important;
                page-break-inside: avoid !important;
                page-break-after: avoid !important;
            }
            
            /* Further optimize for print */
            .kingu-logo { font-size: 32px !important; }
            .electrical-logo { font-size: 24px !important; }
            .company-logo { font-size: 14px !important; }
            .invoice-title { font-size: 20px !important; }
            .invoice-items-preview { font-size: 10px !important; }
            .invoice-items-preview th,
            .invoice-items-preview td { padding: 8px 6px !important; }
            .invoice-totals { width: 250px !important; font-size: 11px !important; }
            
            /* Hide non-printable elements */
            .sidebar, 
            .header, 
            .invoice-form-container, 
            .action-buttons, 
            .invoice-type-selector,
            .nav-menu,
            .btn,
            button,
            .history-container,
            .main-content > *:not(.invoice-preview-container):not(.a4-document),
            .no-print {
                display: none !important;
                visibility: hidden !important;
            }
            
            .container {
                display: block !important;
                width: 100% !important;
                height: 100% !important;
            }
            
            .main-content {
                padding: 0 !important;
                margin: 0 !important;
                width: 100% !important;
                height: 100% !important;
            }
            
            .stamp, .quotation-stamp {
                display: block !important;
                visibility: visible !important;
                font-size: 10px !important;
                padding: 8px 15px !important;
                right: 15mm !important;
                bottom: 15mm !important;
            }
            
            .quotation-stamp {
                top: 15mm !important;
            }
            
            .invoice-footer {
                margin-top: 20px !important;
                font-size: 10px !important;
            }
            
            /* Prevent page breaks inside important elements */
            .invoice-header,
            .invoice-details,
            .invoice-items-preview,
            .invoice-totals,
            .terms-section {
                page-break-inside: avoid !important;
            }
        }

        /* A4 Preview Container */
        .a4-preview-container {
            display: none;
            width: 210mm;
            min-height: 297mm;
            margin: 20px auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            padding: 20mm;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
            font-size: 11pt;
            line-height: 1.3;
        }

        .a4-document {
            width: 100%;
            height: 100%;
        }

        .a4-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20pt;
            padding-bottom: 10pt;
            border-bottom: 2pt solid #116a41;
            page-break-inside: avoid;
        }

        .a4-company-info h1 {
            font-size: 18pt;
            color: #116a41;
            margin-bottom: 5pt;
        }

        .a4-company-info p {
            font-size: 9pt;
            margin-bottom: 2pt;
            color: #555;
        }

        .a4-document-title h2 {
            font-size: 20pt;
            color: #116a41;
            text-align: right;
            margin: 0;
        }

        .a4-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20pt;
            margin-bottom: 20pt;
            page-break-inside: avoid;
        }

        .a4-bill-to, .a4-from {
            padding: 10pt;
            background: #f8f9fa;
            border-radius: 5pt;
        }

        .a4-bill-to h3, .a4-from h3 {
            color: #116a41;
            margin-bottom: 10pt;
            font-size: 14pt;
        }

        .a4-client-details p,
        .a4-company-details p {
            margin-bottom: 4pt;
            font-size: 10pt;
        }

        .a4-document-info {
            margin-bottom: 20pt;
            padding: 10pt;
            background: #e8f5e9;
            border-radius: 5pt;
            page-break-inside: avoid;
        }

        .a4-document-info p {
            margin-bottom: 6pt;
            display: flex;
            justify-content: space-between;
            font-size: 10pt;
        }

        .a4-items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20pt;
            page-break-inside: avoid;
        }

        .a4-items-table th {
            background: #116a41;
            color: white;
            padding: 8pt 10pt;
            text-align: left;
            font-weight: bold;
            font-size: 10pt;
        }

        .a4-items-table td {
            padding: 6pt 10pt;
            border-bottom: 1pt solid #ddd;
            font-size: 10pt;
        }

        .a4-items-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .a4-totals {
            width: 50%;
            margin-left: auto;
            margin-bottom: 20pt;
            padding: 15pt;
            background: #f8f9fa;
            border-radius: 5pt;
            page-break-inside: avoid;
        }

        .a4-total-row {
            display: flex;
            justify-content: space-between;
            padding: 5pt 0;
            border-bottom: 1pt solid #ddd;
            font-size: 10pt;
        }

        .a4-grand-total {
            border-top: 2pt solid #116a41;
            margin-top: 10pt;
            padding-top: 10pt;
            font-weight: bold;
            font-size: 12pt;
        }

        .a4-amount-words {
            margin-top: 10pt;
            padding: 10pt;
            background: #e8f5e9;
            border-radius: 5pt;
            font-style: italic;
            font-size: 10pt;
        }

        .a4-terms {
            margin-top: 20pt;
            padding: 15pt;
            border-top: 2pt solid #e63946;
            background: #f8f9fa;
            page-break-inside: avoid;
        }

        .a4-terms h3 {
            color: #116a41;
            margin-bottom: 10pt;
            font-size: 14pt;
        }

        .a4-footer {
            margin-top: 30pt;
            padding-top: 20pt;
            border-top: 1pt solid #ddd;
            text-align: center;
            page-break-inside: avoid;
        }

        .a4-signature {
            margin: 30pt auto;
            width: 50%;
        }

        .a4-signature-line {
            width: 200pt;
            height: 1pt;
            background: #000;
            margin: 0 auto 10pt;
        }

        .a4-note {
            font-style: italic;
            color: #666;
            font-size: 9pt;
        }

        @media screen and (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .invoice-details {
                flex-direction: column;
                gap: 20px;
            }
            
            .invoice-totals {
                width: 100%;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .action-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .a4-preview-container {
                width: 100%;
                padding: 10mm;
                zoom: 0.8;
            }
        }

        /* A4 specific styles for screen preview */
        @media screen and (min-width: 800px) {
            .invoice-preview-container {
                width: 210mm;
                min-height: 297mm;
                padding: 20mm;
                margin: 20px auto;
                box-shadow: 0 0 20px rgba(0,0,0,0.1);
                position: relative;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="logo-text">
                    <div class="company-header">
                        <span class="kingu">Kingu</span>
                        <span class="electrical">Electrical</span>
                    </div>
                    <div class="company-full-name">Company Limited</div>
                    <div class="company-tagline">Quality Electrical Services with Professional Experience</div>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" id="nav-create">
                        <i class="fas fa-file-invoice-dollar"></i> Create Invoice
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="nav-proforma">
                        <i class="fas fa-file-contract"></i> Proforma Invoices
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="nav-history">
                        <i class="fas fa-history"></i> Document History
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="nav-clients">
                        <i class="fas fa-users"></i> Client Database
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="nav-reports">
                        <i class="fas fa-chart-bar"></i> Reports & Analytics
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="nav-settings">
                        <i class="fas fa-cog"></i> System Settings
                    </a>
                </li>
            </ul>
            
            <div class="company-info-sidebar">
                <p><i class="fas fa-map-marker-alt"></i> <span>P.O. Box 62313<br>Dar Es Salaam Tanzania</span></p>
                <p><i class="fas fa-hashtag"></i> TIN: 157-024-493</p>
                <p><i class="fas fa-phone"></i> +255 677 01 47 40</p>
                <p><i class="fas fa-phone"></i> +255 763 95 79 08</p>
                <p><i class="fas fa-phone"></i> +255 682 84 35 52</p>
                <p><i class="fab fa-whatsapp"></i> +255 682 84 35 52 <span class="contact-badge">WHATSAPP</span></p>
                <p><i class="fas fa-envelope"></i> kinguelectricaltz@gmail.com</p>
                <p><i class="fas fa-university"></i> STANBIC BANK<br>912 000 275 9274</p>
                
                <div class="contact-badges">
                    <span class="contact-badge-small">
                        <i class="fas fa-phone"></i> Call Us
                    </span>
                    <span class="contact-badge-small whatsapp-badge">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </span>
                    <span class="contact-badge-small email-badge">
                        <i class="fas fa-envelope"></i> Email
                    </span>
                </div>
                
                <div class="color-scheme">
                    <div class="color-box green" title="Kingu Green: #116a41"></div>
                    <div class="color-box red" title="Electrical Red: #e63946"></div>
                    <div class="color-box yellow-start" title="Light Bulb Start: #ffae42"></div>
                    <div class="color-box yellow-end" title="Light Bulb End: #ffea00"></div>
                    <div class="color-box blue" title="Quotation Blue: #2980b9"></div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <h1 id="page-title">Create Proforma Invoice</h1>
                <div>
                    <button class="btn btn-whatsapp" id="whatsapp-btn" style="margin-right: 10px;">
                        <i class="fab fa-whatsapp"></i> Share Document
                    </button>
                    <button class="btn btn-pdf" id="pdf-btn" style="display: none; margin-right: 10px;">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <button class="btn btn-accent" id="load-sample-btn">
                        <i class="fas fa-file-import"></i> Load Sample
                    </button>
                    <button class="btn btn-secondary" id="print-btn" style="display: none;">
                        <i class="fas fa-print"></i> Print Document
                    </button>
                    <button class="btn btn-success" id="new-document-btn" style="margin-right: 10px;">
                        <i class="fas fa-plus"></i> New Document
                    </button>
                </div>
            </div>
            
            <div class="invoice-type-selector">
                <button class="type-btn active" id="btn-proforma">Proforma Invoice</button>
                <button class="type-btn" id="btn-standard">Standard Invoice</button>
                <button class="type-btn" id="btn-quotation">Quotation</button>
            </div>
            
            <!-- Invoice Form -->
            <div id="invoice-form" class="invoice-form-container">
                <div class="form-section">
                    <h3 class="section-title" id="details-title"><i class="fas fa-info-circle"></i> Invoice Details</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="invoice-number" id="doc-number-label">Invoice Number</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" id="invoice-number" class="form-control" value="PROFORMA/GL/06/2025/001" style="flex: 1;">
                                <button class="btn" style="margin-left: 10px; padding: 10px 15px; background-color: var(--kingu-light);" id="generate-number-btn" title="Generate New Number">
                                    <i class="fas fa-redo"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="invoice-date" id="doc-date-label">Invoice Date</label>
                            <input type="date" id="invoice-date" class="form-control" value="">
                        </div>
                        <div class="form-group">
                            <label for="due-date">Due Date</label>
                            <input type="date" id="due-date" class="form-control" value="">
                        </div>
                    </div>
                    
                    <div class="proforma-fields" id="extra-fields">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="currency">Currency</label>
                                <select id="currency" class="form-control currency-select">
                                    <option value="TSh">Tanzanian Shilling (TSh)</option>
                                    <option value="USD">US Dollar ($)</option>
                                    <option value="EUR">Euro (€)</option>
                                    <option value="GBP">British Pound (£)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="delivery-time">Delivery Time (Days after PO)</label>
                                <input type="number" id="delivery-time" class="form-control" value="7" min="1">
                            </div>
                            <div class="form-group">
                                <label for="payment-terms">Payment Terms</label>
                                <select id="payment-terms" class="form-control">
                                    <option value="100% after delivery">100% after delivery</option>
                                    <option value="50% advance, 50% after delivery">50% advance, 50% after delivery</option>
                                    <option value="30 days net">30 days net</option>
                                    <option value="Custom">Custom</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row" id="custom-terms-container" style="display: none;">
                            <div class="form-group">
                                <label for="custom-payment-terms">Custom Payment Terms</label>
                                <textarea id="custom-payment-terms" class="form-control" rows="2" placeholder="Enter custom payment terms"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-user-tie"></i> Client Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="client-name">Client Name</label>
                            <div style="display: flex;">
                                <input type="text" id="client-name" class="form-control" placeholder="Enter client name" value="GREENLIGHT PLANNET TANZANIA LTD">
                                <button class="btn" style="margin-left: 10px; padding: 10px 15px; background-color: var(--kingu-light);" id="client-search-btn" title="Search Client Database">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="client-email">Client Email</label>
                            <input type="email" id="client-email" class="form-control" placeholder="Enter client email" value="accounts@greenlight.co.tz">
                        </div>
                        <div class="form-group">
                            <label for="client-phone">Client Phone</label>
                            <input type="text" id="client-phone" class="form-control" placeholder="Enter client phone" value="+255 765 432 100">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="client-address">Client Address</label>
                            <textarea id="client-address" class="form-control" rows="2" placeholder="Enter client address">ARUSHA, TANZANIA</textarea>
                        </div>
                        <div class="form-group">
                            <label for="client-tin">TIN Number</label>
                            <input type="text" id="client-tin" class="form-control" placeholder="Enter TIN number" value="109-628-980">
                        </div>
                        <div class="form-group">
                            <label for="client-vat">VAT Number (if applicable)</label>
                            <input type="text" id="client-vat" class="form-control" placeholder="Enter VAT number">
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title" id="items-title"><i class="fas fa-list-alt"></i> Invoice Items</h3>
                    <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                        <button class="btn" style="background-color: var(--kingu-light); color: var(--kingu-green);" id="add-service-item">
                            <i class="fas fa-wrench"></i> Add Service
                        </button>
                        <button class="btn" style="background-color: var(--kingu-light); color: var(--kingu-green);" id="add-product-item">
                            <i class="fas fa-box"></i> Add Product
                        </button>
                        <button class="btn" style="background-color: var(--kingu-light); color: var(--kingu-green);" id="add-labor-item">
                            <i class="fas fa-user-hard-hat"></i> Add Labor
                        </button>
                    </div>
                    <table class="items-table" id="items-table">
                        <thead>
                            <tr>
                                <th>DESCRIPTION</th>
                                <th style="width: 100px;">UNITS</th>
                                <th style="width: 150px;">UNIT PRICE</th>
                                <th style="width: 150px;">AMOUNT</th>
                                <th style="width: 80px;">ACTION</th>
                            </tr>
                        </thead>
                        <tbody id="invoice-items">
                            <tr>
                                <td><input type="text" class="item-description" placeholder="Service description" value="Engine service and Preventive maintenance"></td>
                                <td><input type="number" class="item-quantity" min="0" step="0.01" value="1.00"></td>
                                <td>
                                    <div style="display: flex; align-items: center;">
                                        <span class="currency-symbol" style="margin-right: 5px;">TSh</span>
                                        <input type="number" class="item-price" min="0" step="0.01" value="350000.00" style="flex: 1;">
                                    </div>
                                </td>
                                <td class="item-total text-right">TSh 350,000.00</td>
                                <td class="text-center"><button class="delete-item"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td><input type="text" class="item-description" placeholder="Service description" value="PLC check and configuration"></td>
                                <td><input type="number" class="item-quantity" min="0" step="0.01" value="1.00"></td>
                                <td>
                                    <div style="display: flex; align-items: center;">
                                        <span class="currency-symbol" style="margin-right: 5px;">TSh</span>
                                        <input type="number" class="item-price" min="0" step="0.01" value="250000.00" style="flex: 1;">
                                    </div>
                                </td>
                                <td class="item-total text-right">TSh 250,000.00</td>
                                <td class="text-center"><button class="delete-item"><i class="fas fa-trash"></i></button></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <button class="add-item-btn" id="add-item-btn">
                        <i class="fas fa-plus-circle"></i> Add Custom Item
                    </button>
                    
                    <div style="margin-top: 20px; display: flex; gap: 15px; align-items: center;">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label for="discount-type">Discount</label>
                            <select id="discount-type" class="form-control">
                                <option value="none">No Discount</option>
                                <option value="percentage">Percentage %</option>
                                <option value="fixed">Fixed Amount</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1; margin-bottom: 0; display: none;" id="discount-value-container">
                            <label for="discount-value">Discount Value</label>
                            <input type="number" id="discount-value" class="form-control" min="0" step="0.01" value="0">
                        </div>
                    </div>
                </div>
                
                <div class="totals-section" id="totals-section">
                    <div class="total-row">
                        <span class="total-label">Subtotal:</span>
                        <span class="total-value" id="subtotal">TSh 600,000.00</span>
                    </div>
                    <div class="total-row" id="discount-row" style="display: none;">
                        <span class="total-label" id="discount-label">Discount:</span>
                        <span class="total-value" id="discount-amount">TSh 0.00</span>
                    </div>
                    <div class="total-row">
                        <span class="total-label">VAT (18%):</span>
                        <span class="total-value" id="tax">TSh 108,000.00</span>
                    </div>
                    <div class="total-row grand-total">
                        <span class="total-label" id="grand-total-label">GRAND TOTAL:</span>
                        <span class="total-value" id="grand-total">TSh 708,000.00</span>
                    </div>
                    <div class="total-row" style="margin-top: 10px; font-size: 14px; color: #666;">
                        <span class="total-label">Amount in Words:</span>
                        <span class="total-value" id="amount-words">Seven hundred eight thousand Tanzanian Shillings only</span>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-file-signature"></i> Terms & Conditions</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bank-details">Bank Details</label>
                            <textarea id="bank-details" class="form-control" rows="3">BANK: STANBIC BANK TANZANIA LIMITED
ACCOUNT NAME: KINGU ELECTRICAL COMPANY LIMITED
ACCOUNT NUMBER: 912 000 275 9274
SWIFT CODE: SBICTZTX</textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="notes">Additional Notes / Special Instructions</label>
                            <textarea id="notes" class="form-control" rows="4" placeholder="Add any additional notes here...">1. This Proforma shall remain valid for 30 days only.
2. Prices are inclusive of VAT where applicable.
3. Delivery subject to stock availability.
4. All disputes subject to Dar es Salaam jurisdiction.</textarea>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="clear-btn">
                        <i class="fas fa-redo"></i> Clear Form
                    </button>
                    <button class="btn btn-success" id="preview-btn">
                        <i class="fas fa-eye"></i> Preview Document
                    </button>
                    <button class="btn btn-primary" id="save-btn">
                        <i class="fas fa-save"></i> Save Proforma
                    </button>
                    <button class="btn" style="background-color: var(--kingu-accent); color: white;" id="send-email-btn">
                        <i class="fas fa-paper-plane"></i> Send via Email
                    </button>
                </div>
            </div>
            
            <!-- Enhanced A4 Preview -->
            <div id="a4-preview" class="a4-preview-container">
                <div class="a4-document" id="a4-document-content">
                    <!-- Content will be inserted here by JavaScript -->
                </div>
            </div>
            
            <!-- Original Preview (Hidden) -->
            <div id="invoice-preview" class="invoice-preview-container" style="display: none;">
                <!-- Original preview content -->
            </div>
            
            <!-- Client Database Section -->
            <div id="client-database" class="history-container">
                <h2 style="color: var(--kingu-green); margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between;">
                    <span><i class="fas fa-users" style="margin-right: 10px;"></i> Client Database</span>
                    <button class="btn btn-primary" id="add-client-btn">
                        <i class="fas fa-user-plus"></i> Add New Client
                    </button>
                </h2>
                <div id="client-list">
                    <p>Loading client database...</p>
                </div>
            </div>
            
            <!-- Proforma Invoices Section -->
            <div id="proforma-invoices" class="history-container">
                <h2 style="color: var(--kingu-green); margin-bottom: 20px; display: flex; align-items: center;">
                    <i class="fas fa-file-contract" style="margin-right: 10px;"></i> Proforma Invoices
                </h2>
                <div id="proforma-list">
                    <p>Loading proforma invoices...</p>
                </div>
            </div>
            
            <!-- Invoice History Section -->
            <div id="invoice-history" class="history-container">
                <h2 style="color: var(--kingu-green); margin-bottom: 20px; display: flex; align-items: center;">
                    <i class="fas fa-history" style="margin-right: 10px;"></i> Document History
                </h2>
                <div id="history-list">
                    <p>Loading document history...</p>
                </div>
            </div>
            
            <!-- Reports Section -->
            <div id="reports-section" class="history-container">
                <h2 style="color: var(--kingu-green); margin-bottom: 20px; display: flex; align-items: center;">
                    <i class="fas fa-chart-bar" style="margin-right: 10px;"></i> Reports & Analytics
                </h2>
                <div id="reports-content">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3 style="color: var(--kingu-green); margin-bottom: 15px;">Sales Overview</h3>
                            <p>Total Revenue: <strong>TSh 0.00</strong></p>
                            <p>Invoices This Month: <strong>0</strong></p>
                            <p>Pending Payments: <strong>TSh 0.00</strong></p>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3 style="color: var(--kingu-green); margin-bottom: 15px;">Quick Actions</h3>
                            <button class="btn" style="width: 100%; margin-bottom: 10px; background-color: var(--kingu-light);">
                                <i class="fas fa-file-export"></i> Export Monthly Report
                            </button>
                            <button class="btn" style="width: 100%; margin-bottom: 10px; background-color: var(--kingu-light);">
                                <i class="fas fa-chart-pie"></i> View Sales Chart
                            </button>
                            <button class="btn" style="width: 100%; background-color: var(--kingu-light);">
                                <i class="fas fa-file-invoice"></i> Generate Tax Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Section -->
            <div id="settings-section" class="history-container">
                <h2 style="color: var(--kingu-green); margin-bottom: 20px; display: flex; align-items: center;">
                    <i class="fas fa-cog" style="margin-right: 10px;"></i> System Settings
                </h2>
                <div id="settings-content">
                    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--kingu-green); margin-bottom: 15px;">Company Settings</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Default Currency</label>
                                <select class="form-control">
                                    <option selected>Tanzanian Shilling (TSh)</option>
                                    <option>US Dollar ($)</option>
                                    <option>Euro (€)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Default VAT Rate (%)</label>
                                <input type="number" class="form-control" value="18" min="0" max="100">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Invoice Number Prefix</label>
                                <input type="text" class="form-control" value="PROFORMA/GL">
                            </div>
                            <div class="form-group">
                                <label>Default Payment Terms</label>
                                <select class="form-control">
                                    <option selected>100% after delivery</option>
                                    <option>50% advance, 50% after delivery</option>
                                    <option>30 days net</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" style="margin-top: 20px;">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Enhanced A4 Document Generator
        class A4DocumentGenerator {
            constructor() {
                this.currentDocument = null;
            }
            
            createProformaTemplate(data) {
                const isQuotation = data.type === 'Quotation';
                const documentTitle = isQuotation ? 'QUOTATION' : (data.type === 'Proforma' ? 'PROFORMA INVOICE' : 'TAX INVOICE');
                
                return `
                    <div class="a4-header">
                        <div class="a4-company-info">
                            <h1>KINGU ELECTRICAL COMPANY LIMITED</h1>
                            <p>TIN: 157-024-493</p>
                            <p>Quality Electrical Services with Professional Experience</p>
                            <p>P.O. Box 62313, Dar Es Salaam Tanzania</p>
                            <p>Tel: +255 677 01 47 40 | +255 763 95 79 08 | +255 682 84 35 52</p>
                            <p>Email: kinguelectricaltz@gmail.com</p>
                        </div>
                        <div class="a4-document-title">
                            <h2>${documentTitle}</h2>
                        </div>
                    </div>
                    
                    <div class="a4-details-grid">
                        <div class="a4-bill-to">
                            <h3>${isQuotation ? 'TO:' : 'BILL TO:'}</h3>
                            <div class="a4-client-details">
                                <p><strong>${data.clientName || 'Client Name'}</strong></p>
                                <p>${data.clientAddress || 'Client Address'}</p>
                                ${data.clientTIN ? `<p>TIN: ${data.clientTIN}</p>` : ''}
                                ${data.clientVAT ? `<p>VAT: ${data.clientVAT}</p>` : ''}
                                ${data.clientPhone ? `<p>Phone: ${data.clientPhone}</p>` : ''}
                                ${data.clientEmail ? `<p>Email: ${data.clientEmail}</p>` : ''}
                            </div>
                        </div>
                        
                        <div class="a4-from">
                            <h3>FROM:</h3>
                            <div class="a4-company-details">
                                <p><strong>KINGU ELECTRICAL COMPANY LIMITED</strong></p>
                                <p>TIN: 157-024-493</p>
                                <p>P.O. Box 62313, Dar Es Salaam Tanzania</p>
                                <p>Phone: +255 677 01 47 40</p>
                                <p>Email: kinguelectricaltz@gmail.com</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="a4-document-info">
                        <p><strong>${isQuotation ? 'Quotation #:' : 'Invoice #:'}</strong> <span>${data.documentNumber || ''}</span></p>
                        <p><strong>${isQuotation ? 'Quotation Date:' : 'Invoice Date:'}</strong> <span>${this.formatDate(data.documentDate)}</span></p>
                        <p><strong>Due Date:</strong> <span>${this.formatDate(data.dueDate)}</span></p>
                        <p><strong>Delivery:</strong> <span>${data.deliveryTime || '7'} days after PO</span></p>
                        <p><strong>Payment Terms:</strong> <span>${data.paymentTerms || ''}</span></p>
                    </div>
                    
                    <div class="a4-subject">
                        <h3>Subject: ${isQuotation ? 'Quotation for Electrical Services' : (data.type === 'Proforma' ? 'Proforma Invoice for Electrical Services' : 'Invoice for Electrical Services')}</h3>
                        <p>${isQuotation ? 
                            'Thank you for your inquiry. We are pleased to submit our quotation for the requested electrical services. All prices are inclusive of VAT where applicable and are valid for 30 days.' : 
                            (data.type === 'Proforma' ? 
                            'This proforma invoice is prepared for the services rendered. All prices are inclusive of VAT where applicable.' : 
                            'This invoice is prepared for the services rendered. All prices are inclusive of VAT where applicable.')}</p>
                    </div>
                    
                    <table class="a4-items-table">
                        <thead>
                            <tr>
                                <th>DESCRIPTION</th>
                                <th>UNITS</th>
                                <th>UNIT PRICE</th>
                                <th>AMOUNT</th>
                            </tr>
                        </thead>
                        <tbody id="a4-items-body">
                            ${this.generateItemsHTML(data.items || [], data.currency)}
                        </tbody>
                    </table>
                    
                    <div class="a4-totals">
                        ${this.generateTotalsHTML(data, isQuotation)}
                    </div>
                    
                    <div class="a4-terms">
                        <h3>TERMS & CONDITIONS</h3>
                        <div class="a4-terms-content">
                            ${data.bankDetails ? `<p><strong>Bank Details:</strong> ${data.bankDetails.replace(/\n/g, '<br>')}</p>` : ''}
                            ${data.notes ? `<p>${data.notes.replace(/\n/g, '<br>')}</p>` : ''}
                            <div class="a4-contact-info">
                                <p><i class="fas fa-phone"></i> +255 677 014 740</p>
                                <p><i class="fab fa-whatsapp"></i> +255 682 843 552</p>
                                <p><i class="fas fa-envelope"></i> Kinguelectricaltz@gmail.com</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="a4-footer">
                        <div class="a4-signature">
                            <div class="a4-signature-line"></div>
                            <p>Authorized Signature & Company Stamp</p>
                        </div>
                        <div class="a4-footer-text">
                            <p>${isQuotation ? 
                                'Thank you for considering our quotation. We look forward to the opportunity to serve you.' : 
                                'Thank you for your business! We value our partnership and look forward to serving you.'}</p>
                            <p class="a4-note">${isQuotation ? 
                                'This is a computer-generated quotation. No signature is required.' : 
                                'This is a computer-generated document. No signature is required.'}</p>
                        </div>
                    </div>
                `;
            }
            
            generateItemsHTML(items, currency) {
                if (!items || items.length === 0) {
                    return '<tr><td colspan="4" style="text-align: center; padding: 20pt;">No items</td></tr>';
                }
                
                return items.map(item => `
                    <tr>
                        <td>${item.description || ''}</td>
                        <td style="text-align: center;">${parseFloat(item.quantity || 0).toFixed(2)}</td>
                        <td style="text-align: right;">${this.formatCurrency(item.price || 0, currency)}</td>
                        <td style="text-align: right;">${this.formatCurrency(item.total || 0, currency)}</td>
                    </tr>
                `).join('');
            }
            
            generateTotalsHTML(data, isQuotation) {
                const currency = data.currency || 'TSh';
                
                return `
                    <div class="a4-total-row">
                        <span>Subtotal:</span>
                        <span>${this.formatCurrency(data.subtotal || 0, currency)}</span>
                    </div>
                    ${(data.discount || 0) > 0 ? `
                    <div class="a4-total-row">
                        <span>Discount:</span>
                        <span>${this.formatCurrency(data.discount || 0, currency)}</span>
                    </div>
                    ` : ''}
                    <div class="a4-total-row">
                        <span>VAT (18%):</span>
                        <span>${this.formatCurrency(data.tax || 0, currency)}</span>
                    </div>
                    <div class="a4-total-row a4-grand-total">
                        <span>${isQuotation ? 'TOTAL QUOTATION:' : 'GRAND TOTAL:'}</span>
                        <span>${this.formatCurrency(data.grandTotal || 0, currency)}</span>
                    </div>
                    <div class="a4-amount-words">
                        <strong>Amount in Words:</strong> ${this.numberToWords(Math.round(data.grandTotal || 0))}
                    </div>
                `;
            }
            
            formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return '';
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
            
            formatCurrency(amount, currency = 'TSh') {
                const symbol = currency === 'TSh' ? 'TSh ' : 
                              currency === 'USD' ? '$' :
                              currency === 'EUR' ? '€' : '£';
                const formatted = parseFloat(amount).toFixed(2)
                    .replace(/\d(?=(\d{3})+\.)/g, '$&,');
                return symbol + formatted;
            }
            
            numberToWords(num) {
                const units = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
                const teens = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
                const tens = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
                
                if (num === 0) return 'zero Tanzanian Shillings only';
                
                let words = '';
                const million = Math.floor(num / 1000000);
                const thousand = Math.floor((num % 1000000) / 1000);
                const remainder = num % 1000;
                
                if (million > 0) {
                    words += this.convertThreeDigits(million) + ' million ';
                }
                if (thousand > 0) {
                    words += this.convertThreeDigits(thousand) + ' thousand ';
                }
                if (remainder > 0) {
                    words += this.convertThreeDigits(remainder);
                }
                
                return words.trim() + ' Tanzanian Shillings only';
            }
            
            convertThreeDigits(n) {
                const units = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
                const teens = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
                const tens = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
                
                let result = '';
                if (n >= 100) {
                    result += units[Math.floor(n / 100)] + ' hundred ';
                    n %= 100;
                }
                if (n >= 20) {
                    result += tens[Math.floor(n / 10)] + ' ';
                    n %= 10;
                } else if (n >= 10) {
                    result += teens[n - 10] + ' ';
                    n = 0;
                }
                if (n > 0) {
                    result += units[n] + ' ';
                }
                return result.trim();
            }
            
            generatePDF(documentElement, filename = 'document.pdf') {
                return new Promise((resolve, reject) => {
                    try {
                        const pdf = new jsPDF('p', 'mm', 'a4');
                        
                        // Set PDF properties
                        pdf.setProperties({
                            title: filename.replace('.pdf', ''),
                            subject: 'Invoice Document',
                            author: 'KINGU ELECTRICAL COMPANY LIMITED',
                            keywords: 'invoice, proforma, quotation, electrical',
                            creator: 'KINGU Invoice System'
                        });
                        
                        html2canvas(documentElement, {
                            scale: 2,
                            useCORS: true,
                            logging: false,
                            backgroundColor: '#ffffff',
                            width: documentElement.offsetWidth,
                            height: documentElement.offsetHeight
                        }).then(canvas => {
                            const imgData = canvas.toDataURL('image/png');
                            const imgWidth = 210 - 30; // A4 width minus margins
                            const imgHeight = (canvas.height * imgWidth) / canvas.width;
                            
                            pdf.addImage(imgData, 'PNG', 15, 15, imgWidth, imgHeight);
                            pdf.save(filename);
                            resolve(pdf);
                        }).catch(reject);
                    } catch (error) {
                        reject(error);
                    }
                });
            }
            
            printDocument(documentElement) {
                const printWindow = window.open('', '_blank');
                const printContent = documentElement.cloneNode(true);
                
                // Apply print styles
                printContent.style.width = '210mm';
                printContent.style.minHeight = '297mm';
                printContent.style.padding = '15mm';
                printContent.style.boxSizing = 'border-box';
                printContent.style.fontFamily = 'Arial, sans-serif';
                printContent.style.fontSize = '11pt';
                printContent.style.lineHeight = '1.3';
                
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Print Document</title>
                        <style>
                            @page {
                                size: A4;
                                margin: 15mm;
                            }
                            body {
                                margin: 0;
                                padding: 0;
                                font-family: Arial, sans-serif;
                                font-size: 11pt;
                                line-height: 1.3;
                                color: #000;
                            }
                            .print-container {
                                width: 210mm;
                                min-height: 297mm;
                                padding: 15mm;
                                box-sizing: border-box;
                            }
                            table {
                                width: 100%;
                                border-collapse: collapse;
                                page-break-inside: avoid;
                            }
                            th, td {
                                padding: 4pt 6pt;
                                border: 1px solid #ddd;
                                font-size: 10pt;
                            }
                            .no-break {
                                page-break-inside: avoid;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="print-container">
                            ${printContent.innerHTML}
                        </div>
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(() => window.close(), 1000);
                            };
                        <\/script>
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
            }
        }
        
        // Main Application
        document.addEventListener('DOMContentLoaded', function() {
            const docGenerator = new A4DocumentGenerator();
            
            // DOM Elements
            const invoiceForm = document.getElementById('invoice-form');
            const a4Preview = document.getElementById('a4-preview');
            const invoicePreview = document.getElementById('invoice-preview');
            const printBtn = document.getElementById('print-btn');
            const pdfBtn = document.getElementById('pdf-btn');
            const previewBtn = document.getElementById('preview-btn');
            const saveBtn = document.getElementById('save-btn');
            const a4DocumentContent = document.getElementById('a4-document-content');
            
            // Set default dates
            const today = new Date();
            document.getElementById('invoice-date').valueAsDate = today;
            
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            document.getElementById('due-date').valueAsDate = dueDate;
            
            // Initialize totals
            updateTotals();
            
            // Setup event listeners
            setupEventListeners();
            
            // Enhanced Preview Functionality
            previewBtn.addEventListener('click', function() {
                const formData = collectFormData();
                const template = docGenerator.createProformaTemplate(formData);
                
                a4DocumentContent.innerHTML = template;
                a4Preview.style.display = 'block';
                invoiceForm.style.display = 'none';
                invoicePreview.style.display = 'none';
                
                // Show action buttons
                printBtn.style.display = 'inline-flex';
                pdfBtn.style.display = 'inline-flex';
                
                // Hide all other sections
                document.querySelectorAll('.history-container').forEach(container => {
                    container.style.display = 'none';
                });
            });
            
            // Enhanced Print Functionality
            printBtn.addEventListener('click', function() {
                docGenerator.printDocument(a4DocumentContent);
            });
            
            // Enhanced PDF Export
            pdfBtn.addEventListener('click', function() {
                const formData = collectFormData();
                const filename = `Kingu_${formData.type || 'Proforma'}_${formData.documentNumber || 'Document'}.pdf`;
                
                pdfBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
                pdfBtn.disabled = true;
                
                docGenerator.generatePDF(a4DocumentContent, filename)
                    .then(() => {
                        pdfBtn.innerHTML = '<i class="fas fa-file-pdf"></i> Export PDF';
                        pdfBtn.disabled = false;
                    })
                    .catch(error => {
                        console.error('PDF generation error:', error);
                        pdfBtn.innerHTML = '<i class="fas fa-file-pdf"></i> Export PDF';
                        pdfBtn.disabled = false;
                        alert('Error generating PDF. Please try again.');
                    });
            });
            
            // Enhanced Save Functionality
            saveBtn.addEventListener('click', function() {
                const formData = collectFormData();
                
                // Save to localStorage
                let documents = JSON.parse(localStorage.getItem('kinguDocuments')) || [];
                documents.push({
                    ...formData,
                    id: Date.now(),
                    savedDate: new Date().toISOString()
                });
                localStorage.setItem('kinguDocuments', JSON.stringify(documents));
                
                // Generate PDF automatically
                const filename = `Kingu_${formData.type || 'Proforma'}_${formData.documentNumber || 'Document'}.pdf`;
                docGenerator.generatePDF(a4DocumentContent, filename);
                
                alert(`${formData.type || 'Document'} saved successfully!\nPDF has been generated and saved.`);
            });
            
            // Helper Functions
            function collectFormData() {
                const isProforma = document.getElementById('btn-proforma').classList.contains('active');
                const isStandard = document.getElementById('btn-standard').classList.contains('active');
                const isQuotation = document.getElementById('btn-quotation').classList.contains('quotation-active');
                
                return {
                    type: isQuotation ? 'Quotation' : (isProforma ? 'Proforma' : 'Standard'),
                    documentNumber: document.getElementById('invoice-number').value,
                    documentDate: document.getElementById('invoice-date').value,
                    dueDate: document.getElementById('due-date').value,
                    currency: document.getElementById('currency').value,
                    deliveryTime: document.getElementById('delivery-time').value,
                    clientName: document.getElementById('client-name').value,
                    clientEmail: document.getElementById('client-email').value,
                    clientPhone: document.getElementById('client-phone').value,
                    clientAddress: document.getElementById('client-address').value,
                    clientTIN: document.getElementById('client-tin').value,
                    clientVAT: document.getElementById('client-vat').value,
                    paymentTerms: document.getElementById('payment-terms').value,
                    bankDetails: document.getElementById('bank-details').value,
                    notes: document.getElementById('notes').value,
                    items: collectItems(),
                    subtotal: extractCurrencyValue(document.getElementById('subtotal').textContent),
                    discount: extractCurrencyValue(document.getElementById('discount-amount').textContent),
                    tax: extractCurrencyValue(document.getElementById('tax').textContent),
                    grandTotal: extractCurrencyValue(document.getElementById('grand-total').textContent)
                };
            }
            
            function collectItems() {
                const items = [];
                document.querySelectorAll('#invoice-items tr').forEach(row => {
                    items.push({
                        description: row.querySelector('.item-description').value,
                        quantity: parseFloat(row.querySelector('.item-quantity').value) || 0,
                        price: parseFloat(row.querySelector('.item-price').value) || 0,
                        total: extractCurrencyValue(row.querySelector('.item-total').textContent)
                    });
                });
                return items;
            }
            
            function extractCurrencyValue(formattedValue) {
                return parseFloat(formattedValue.replace(/[^0-9.-]+/g,"")) || 0;
            }
            
            function updateTotals() {
                // Your existing updateTotals function
                let subtotal = 0;
                const rows = document.querySelectorAll('#invoice-items tr');
                
                rows.forEach(row => {
                    const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                    const price = parseFloat(row.querySelector('.item-price').value) || 0;
                    const total = quantity * price;
                    subtotal += total;
                    
                    const itemTotal = row.querySelector('.item-total');
                    if (itemTotal) {
                        itemTotal.textContent = formatCurrency(total, 'TSh');
                    }
                });
                
                // Apply discount
                const discountType = document.getElementById('discount-type').value;
                const discountValue = parseFloat(document.getElementById('discount-value').value) || 0;
                let discount = 0;
                
                if (discountType === 'percentage' && discountValue > 0) {
                    discount = subtotal * (discountValue / 100);
                } else if (discountType === 'fixed' && discountValue > 0) {
                    discount = discountValue;
                }
                
                const discountedSubtotal = subtotal - discount;
                const vat = discountedSubtotal * 0.18;
                const grandTotal = discountedSubtotal + vat;
                
                document.getElementById('subtotal').textContent = formatCurrency(subtotal, 'TSh');
                document.getElementById('discount-amount').textContent = formatCurrency(discount, 'TSh');
                document.getElementById('tax').textContent = formatCurrency(vat, 'TSh');
                document.getElementById('grand-total').textContent = formatCurrency(grandTotal, 'TSh');
                
                // Update amount in words
                document.getElementById('amount-words').textContent = docGenerator.numberToWords(Math.round(grandTotal));
            }
            
            function formatCurrency(amount, currency) {
                const symbol = currency === 'TSh' ? 'TSh ' : 
                              currency === 'USD' ? '$' :
                              currency === 'EUR' ? '€' : '£';
                const formatted = parseFloat(amount).toFixed(2)
                    .replace(/\d(?=(\d{3})+\.)/g, '$&,');
                return symbol + formatted;
            }
            
            function setupEventListeners() {
                // Item input listeners
                document.querySelectorAll('.item-quantity, .item-price').forEach(input => {
                    input.addEventListener('input', updateTotals);
                });
                
                // Delete item buttons
                document.addEventListener('click', function(e) {
                    if (e.target.closest('.delete-item')) {
                        e.target.closest('tr').remove();
                        updateTotals();
                    }
                });
                
                // Add item button
                document.getElementById('add-item-btn').addEventListener('click', function() {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td><input type="text" class="item-description" placeholder="Service description" value="New service item"></td>
                        <td><input type="number" class="item-quantity" min="0" step="0.01" value="1.00"></td>
                        <td>
                            <div style="display: flex; align-items: center;">
                                <span class="currency-symbol" style="margin-right: 5px;">TSh</span>
                                <input type="number" class="item-price" min="0" step="0.01" value="0.00" style="flex: 1;">
                            </div>
                        </td>
                        <td class="item-total text-right">TSh 0.00</td>
                        <td class="text-center"><button class="delete-item"><i class="fas fa-trash"></i></button></td>
                    `;
                    
                    document.getElementById('invoice-items').appendChild(newRow);
                    
                    newRow.querySelector('.item-quantity').addEventListener('input', updateTotals);
                    newRow.querySelector('.item-price').addEventListener('input', updateTotals);
                    
                    updateTotals();
                });
                
                // Discount handling
                document.getElementById('discount-type').addEventListener('change', function() {
                    const discountValueContainer = document.getElementById('discount-value-container');
                    const discountRow = document.getElementById('discount-row');
                    
                    if (this.value === 'none') {
                        discountValueContainer.style.display = 'none';
                        discountRow.style.display = 'none';
                    } else {
                        discountValueContainer.style.display = 'block';
                        discountRow.style.display = 'flex';
                        document.getElementById('discount-label').textContent = 
                            this.value === 'percentage' ? 'Discount (%):' : 'Discount:';
                    }
                    updateTotals();
                });
                
                document.getElementById('discount-value').addEventListener('input', updateTotals);
                
                // Payment terms custom field
                document.getElementById('payment-terms').addEventListener('change', function() {
                    const customContainer = document.getElementById('custom-terms-container');
                    customContainer.style.display = this.value === 'Custom' ? 'block' : 'none';
                });
                
                // Generate invoice number
                document.getElementById('generate-number-btn').addEventListener('click', function() {
                    const isProforma = document.getElementById('btn-proforma').classList.contains('active');
                    const isStandard = document.getElementById('btn-standard').classList.contains('active');
                    const isQuotation = document.getElementById('btn-quotation').classList.contains('quotation-active');
                    
                    let prefix = 'PROFORMA';
                    if (isStandard) prefix = 'INV';
                    if (isQuotation) prefix = 'QUOTE';
                    
                    const year = new Date().getFullYear();
                    const month = (new Date().getMonth() + 1).toString().padStart(2, '0');
                    const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                    
                    document.getElementById('invoice-number').value = `${prefix}/GL/${month}/${year}/${randomNum}`;
                });
                
                // Clear form
                document.getElementById('clear-btn').addEventListener('click', function() {
                    if (confirm('Are you sure you want to clear the form? All entered data will be lost.')) {
                        invoiceForm.reset();
                        document.getElementById('invoice-items').innerHTML = `
                            <tr>
                                <td><input type="text" class="item-description" placeholder="Service description" value="Service item"></td>
                                <td><input type="number" class="item-quantity" min="0" step="0.01" value="1.00"></td>
                                <td>
                                    <div style="display: flex; align-items: center;">
                                        <span class="currency-symbol" style="margin-right: 5px;">TSh</span>
                                        <input type="number" class="item-price" min="0" step="0.01" value="0.00" style="flex: 1;">
                                    </div>
                                </td>
                                <td class="item-total text-right">TSh 0.00</td>
                                <td class="text-center"><button class="delete-item"><i class="fas fa-trash"></i></button></td>
                            </tr>
                        `;
                        
                        document.getElementById('invoice-date').valueAsDate = new Date();
                        const dueDate = new Date();
                        dueDate.setDate(dueDate.getDate() + 30);
                        document.getElementById('due-date').valueAsDate = dueDate;
                        
                        updateTotals();
                    }
                });
            }
        });
    </script>
</body>
</html>
